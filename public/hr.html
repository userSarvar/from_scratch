<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Management</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .save-icon {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>HR Management</h2>
        <div class="mb-3">
            <button id="toggleTables" class="btn btn-primary">Switch to SV Data</button>
        </div>

        <!-- Promoter Table -->
        <div id="promoterTableContainer">
            <h3>Promoter Data</h3>
            <table id="promoterTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th>Short Text</th>
                        <th>Long Text</th>
                        <th>Time</th>
                        <th>Edit</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Promoter data will be inserted here -->
                </tbody>
            </table>
        </div>

        <!-- SV Table (Initially hidden) -->
        <div id="svTableContainer" style="display:none;">
            <h3>SV Data</h3>
            <table id="svTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Handle</th>
                        <th>Role</th>
                        <th>Age</th>
                        <th>Edit</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- SV data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Toggle between tables
        document.getElementById('toggleTables').addEventListener('click', function () {
            var promoterTableContainer = document.getElementById('promoterTableContainer');
            var svTableContainer = document.getElementById('svTableContainer');
            if (promoterTableContainer.style.display === 'none') {
                promoterTableContainer.style.display = 'block';
                svTableContainer.style.display = 'none';
                this.textContent = 'Switch to SV Data';
            } else {
                promoterTableContainer.style.display = 'none';
                svTableContainer.style.display = 'block';
                this.textContent = 'Switch to Promoter Data';
            }
        });

        // Fetch Promoter Data
        async function fetchPromoterData() {
            const response = await fetch('/get-promoter-data');
            const data = await response.json();
            const tableBody = document.querySelector('#promoterTable tbody');
            tableBody.innerHTML = '';
            data.forEach(item => {
                tableBody.innerHTML += `
                    <tr>
                        <td>${item.shortText}</td>
                        <td>${item.longText}</td>
                        <td>${item.timestamp}</td>
                        <td><span class="save-icon" onclick="editRow(this)">ðŸ–‰</span></td>
                    </tr>
                `;
            });
        }

        // Fetch SV Data
        async function fetchSVData() {
            const response = await fetch('/get-sv-data');
            const data = await response.json();
            const tableBody = document.querySelector('#svTable tbody');
            tableBody.innerHTML = '';
            data.forEach(item => {
                tableBody.innerHTML += `
                    <tr>
                        <td>${item.username}</td>
                        <td>${item.handle}</td>
                        <td>${item.role}</td>
                        <td>${item.age}</td>
                        <td><span class="save-icon" onclick="editRow(this)">ðŸ–‰</span></td>
                    </tr>
                `;
            });
        }

        // Edit Row Function
        function editRow(element) {
            const row = element.parentNode.parentNode;
            const cells = row.querySelectorAll('td:not(:last-child)');
            cells.forEach(cell => {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = cell.textContent;
                cell.textContent = '';
                cell.appendChild(input);
            });
            element.textContent = 'ðŸ’¾'; // Change icon to save
            element.onclick = () => saveRow(element);
        }

        // Save Row Function
        function saveRow(element) {
            const row = element.parentNode.parentNode;
            const cells = row.querySelectorAll('td:not(:last-child)');
            const updatedData = {};
            cells.forEach((cell, index) => {
                const input = cell.querySelector('input');
                if (input) {
                    updatedData[`field${index}`] = input.value;
                    cell.textContent = input.value;
                }
            });
            element.textContent = 'ðŸ–‰'; // Change icon back to edit
            element.onclick = () => editRow(element);

            // Send the updated data to the server (e.g., via a PUT request)
            // fetch('/update-data-url', { method: 'PUT', body: JSON.stringify(updatedData), headers: { 'Content-Type': 'application/json' } });
        }

        // Initial Data Fetch
        fetchPromoterData();
        fetchSVData();
    </script>
</body>
</html>
